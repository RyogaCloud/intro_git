[{"id":"8fe444de.d77088","type":"template","z":"717094a2.6b2a3c","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n    <style>\n        /* マップを含むdiv要素のサイズを定義するために、常にマップの高さを明示的に設定 */\n        #map {\n            height: 100%;\n        }\n        /* サンプルページをウィンドウいっぱいに */\n        html, body {\n            height: 100%;\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"map\"></div>\n    <script>\n        var directionsService;\n        var directionsRenderer;\n        var num = 100;\n        var markers = [];\n        var marker_state;\n        var place_state;\n        var map;\n        var i = 0;\n        var URL;\n        var res;\n        var data;\n        var num_state;\n        var contentString = '<div id=\"content\">'+\n            '<div id=\"siteNotice\">'+\n            '</div>'+\n            '<h1 id=\"firstHeading\" class=\"firstHeading\">名前</h1>'+\n            '<input id=\"help\" type=\"button\" value=\"応援に向かう\" onclick=\"helpButtonClick();\"/><br /><br />'+  // ボタン\n            '<div id=\"output\"></div>'+ \n            '</div>'+\n            '</div>';\n        var myContentString =  '<div id=\"mycontent\">'+\n            '<div id=\"mysiteNotice\">'+\n            '</div>'+\n            '<h1 id=\"myfirstHeading\" class=\"myfirstHeading\">名前</h1>'+\n            '</div>'+\n            '</div>';\n        \n        function init() {\n            URL = '<server_URL>';\n            async function getPlace() {\n                res = await fetch(URL);\n                data = await res.json();\n                return data;\n            }\n\n            var places = [];\n            var id = [];\n\n            getPlace()\n                .then(data => {\n                    console.log(data);\n\n                    for(var tmp of data) {\n                        console.log(tmp.id);\n                        var locate = new google.maps.LatLng(parseFloat(tmp.location.lat), parseFloat(tmp.location.long));\n                        id.push(tmp.name);\n                        places.push(locate);\n                    }\n                    initMap(places, id);\n                })\n                .catch(err => {\n                    console.log(err);\n                })\n        }\n\n        function initMap(places, id) {\n            map = new google.maps.Map(document.getElementById('map'), {\n                zoom: 15,\n                center: {lat: '<latitude>', lng: '<longitude>'}\n            });\n\n            var infowindow = new google.maps.infoWindow({\n                content: contentString\n            });\n\n            var marker = new google.maps.Marker({\n                icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',\n                position: new google.maps.LatLng('<latitude>', '<longitude>'),\n                map: map,\n                title: 'marker'\n            })\n            markers.push(marker);\n            var marker_id = \"<name>\";\n            var state_place = new google.maps.LatLng('<latitude>', '<longitude>');\n            google.maps.event.addListener(marker, 'click', (function(marker, marker_id, state_place) {\n                return function() {\n                    myInfoWindow.open(map, marker);\n                    marker_state = marker;\n                    place_state = marker.position;\n                    setTimeout(() => {\n                        document.getElementById(\"myfirstHeading\").textContent = marker_id;\n                    }, 20)\n                }\n            })(marker, marker_id, state_place));\n        \n            for(var place in places) {\n                var marker = new google.maps.Marker({\n                    icon: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png',\n                    position: places[place],\n                    map: map,\n                    title: 'marker'\n                });\n\n                markers.push(marker);\n                var marker_id = id[place];\n                var state_place = place[place];\n                var num = Number(place);\n\n                google.maps.event.addListener(marker, 'click', (function(marker, marker_id, state_place, num) {\n                    return function() {\n                        infowindow.open(map, marker);\n                        \n                    }\n                }))\n            }\n        }\n    </script>\n</body>\n</html>","output":"str","x":360,"y":220,"wires":[["954040fe.0f2de"]]}]